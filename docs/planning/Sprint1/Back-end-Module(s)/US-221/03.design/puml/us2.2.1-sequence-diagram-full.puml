@startuml
' ==========================================================
' Sequence Diagram – US2.2.1 (Create and Manage Vessel Types)
' Author: Jorge Ubaldo Rodrigues
' Context: Port Management – Vessel Type Module
' ==========================================================

actor "Port Authority Officer" as Officer
boundary "API (VesselTypeController)" as Controller
control "VesselTypeService" as Service
entity "VesselTypeRepository" as Repo
entity "UnitOfWork" as UoW
control "VesselTypeFactory" as Factory
collections "Audit/Logs (ILogger/Serilog)" as Log

== Create ==
Officer -> Controller : POST /api/VesselType\nBody: CreatingVesselTypeDto
Controller -> Service : AddAsync(dto)
Service -> Repo : GetByNameAsync(dto.Name)
Repo --> Service : null / VesselType
Service -> Service : Validate(name unique,\nlength, constraints > 0)
Service -> Factory : CreateBasicVesselType(dto)
Factory --> Service : VesselType (entity)
Service -> Repo : AddAsync(entity)
Repo --> Service : Entity persisted
Service -> UoW : CommitAsync()
UoW --> Service : Transaction committed
Service -> Factory : CreateDtoVesselType(entity)
Factory --> Service : VesselTypeDto
Service -> Log : Log(CREATE, officerId, vesselTypeId, SUCCESS)
Service --> Controller : VesselTypeDto
Controller --> Officer : 201 Created (VesselTypeDto)

== Update ==
Officer -> Controller : PUT /api/VesselType/{id}\nBody: UpdateVesselTypeDto
Controller -> Service : UpdateAsync(id, dto)
Service -> Repo : GetByIdAsync(id)
Repo --> Service : VesselType (existing)
Service -> Service : Validate changes\n(unique name, positive dimensions)
Service -> Repo : Save(updated entity)
Repo --> Service : Entity updated
Service -> UoW : CommitAsync()
UoW --> Service : Transaction committed
Service -> Factory : CreateDtoVesselType(updated)
Factory --> Service : VesselTypeDto
Service -> Log : Log(UPDATE, officerId, vesselTypeId, SUCCESS)
Service --> Controller : VesselTypeDto
Controller --> Officer : 200 OK (VesselTypeDto)

== Search ==
Officer -> Controller : GET /api/VesselType/filter?query=pan
Controller -> Service : FilterAsync(query)
Service -> Repo : FilterAsync(name/description contains query)
Repo --> Service : List<VesselType>
Service -> Factory : CreateDtoVesselType(list)
Factory --> Service : List<VesselTypeDto>
Service -> Log : Log(SEARCH, officerId, query, SUCCESS)
Service --> Controller : List<VesselTypeDto>
Controller --> Officer : 200 OK (List<VesselTypeDto))

@enduml
